### 记录我在开发微信小程序的过程中遇到的一些问题和坑

#### 一、纯前端应该如何处理小程序新的授权流程

- 18年底微信改变了用户授权的方式，不能由小程序自主触发授权，改为必须由用户的操作来实现。我们一般选择在页面上放一个授权按钮，让用户来点击。

- 对于我们来说重要的就是用户openid和unionid，而openid在新用户进入小程序的时候可以通过wx.login方法来获取（回调中要调用服务端的接口来获取）。

- unionid则需要用户点击授权按钮之后调用wx.getUserInfo来获取。

- 我们可以把这两个id存储在storage中，方便以后使用。 

- 但是这样就一直用下去么？显然不是，服务端在和微信的接口通信过程中，会有一个sessionKey的变量，这个变量由微信来控制是否已经过期，如果已经过期，则我们前端需要重新调用wx.login来刷新sessionKey。

- 也就是说，两个id我们可以保存的本地，但是我们在每次用户进入小程序的时候，需要判断当前用户的sessionKey有没有过期，也就是调用wx.checkSession方法，如果过期了，则去调用wx.login来刷新，如果没有过期，则可以直接使用我们保存在本地的两个id。